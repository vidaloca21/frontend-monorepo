# packages/core-lib

### @ci-repo/core-lib

### **개요**

- 프로젝트 전역에서 사용될 http-client, hooks, store, utility 경로입니다.
- 프레임워크 비의존 공통 라이브러리 집합입니다.

### **구조**

### **1. hooks/**

**용도**

공용 React 훅 수용 경로(예: useIsMounted, useDebounce 등)

**현황**

실제 구현 없음

**향후 작업 가이드**

- DOM/브라우저 의존 훅 ↔ 순수 훅(런타임 불문) 분리 네임스페이스 유지
- 공개 훅은 이 경로에서만 export(내부 파일 deep import 금지)
- 예: src/hooks/use-disclosure.ts → src/hooks/index.ts에서 export

### **2. http/**

axios thin-wrapper + Error/Context

**자원**

**http-client.ts**

- Axios 인스턴스(withCredentials: true, timeout: 30s) + 요청/응답 인터셉터 구성
- HttpClientImpl 클래스: get/post/patch/delete 메서드 제공 → HttpResponse<T> 형태로 응답 축약(status, statusText, data)
- 내부 에러는 **clientErrorHandler**를 통해 로깅 및 **ApiClientError**로 변환 가능

**client-error-handler.ts**

- ApiClientError(code/exception/timestamp) 타입화
- axios 에러/비-axios 에러 구분하여 메시지/스택 로깅, toApiClientError() 변환기 제공

**types.ts**

- AdapterRequestConfig/Response/Error → axios 타입 별칭
- ApiResponse<T>, ApiErrorResponse 등 응답 스키마 타입
- HttpClient 인터페이스 & HttpResponse<T> 정의

**http-client-context.tsx**

- HttpClientContext + useHttpClient() 훅 + HttpClientProvider (React 컨텍스트)

**공개 엔트리: index.ts**

```jsx
export * from './client-error-handler'
export * from './types'

export { HttpClientImpl as HttpClient } from './http-client'
export { HttpClientProvider, useHttpClientContext, useHttpClient } from './http-client-context'
```

**사용 예시**

[axios & react-query 사용 예시](http://localhost:3000/example/api)

### **3. store/**

Zustand + Immer + Devtools + Persist 암호화

**자원**

**create-store.ts**

- **보일러플레이트 축약:** immer + devtools를 체인한 createStore<T>()
- set(updater)를 내부 innerSet(updater, false)와 호환시키는 호환 어댑터 포함

**create-enc-store.ts**

- **createEncryptedStore<T>:** persist + 암호화 스토리지 + immer/devtools 조합
- **옵션:**
    - **name(필수):** persist 키**storage:** 'session' | 'local' | StateStorage 커스텀 가능(기본: session)
    - **version:** migrate(persisted, version): 마이그레이션 훅
    - **merge:** rehydrate 시 actions 필드는 현행 인스턴스의 참조 유지(기존 액션 덮어쓰기 방지)

**encrypt-storage-factory.ts**

- **encryptedStorageFactory(storage: Storage):** StateStorage
- **getItem:** 암호화 포맷이 아니면 null 반환(평문 차단)
- **setItem:** 문자열만 저장(객체는 persist가 JSON stringify)
- **noopStorage:** SSR 안전 no-op 구현

**encrypt-cipher.ts**

- **CryptoJS 기반 대칭 암호 + MAC:** 라벨 aes-cbc+hmac-sha256/psk, 버전 1
- **키 파생:** 고정 시크릿(PSK)에서 enc/mac 키 파생(HMAC-SHA256) – 빠르고 동기
- **시크릿:** process.env.NEXT_PUBLIC_ZUSTAND_SECRET (미설정 시 dev 전용 더미 키 사용) → 운영에서는 반드시 환경변수 주입

**types.ts**

- SimpleInit<T>, BaseSetState<T> 등 createStore 내부 호환 타입.

**공개 엔트리: index.ts**

```jsx
export { createStore } from './create-store'
export { createEncryptedStore } from './create-enc-store'

export type { StateCreator } from 'zustand'
export type { SimpleInit } from './types'
```

**사용 예시**

[Zustand Store 사용 예시](http://localhost:3000/example/store)

**유의사항**

- 반드시 운영에서 NEXT_PUBLIC_ZUSTAND_SECRET 주입
- 저장된 값이 평문이면 getItem에서 무시되므로, 마이그레이션 시 암호화 포맷 이관 필요

### **4. utils/**

**용도**

사내에서 많이 쓰는 유틸/오버레이 툴킷을 단일 진입점으로 재노출(의존 버전/교체를 중앙 통제)

**현황**

외부 overlay-kit 라이브러리 export. 로컬 유틸은 없음

[overlay-kit 공식 문서(toss)](https://github.com/toss/overlay-kit/blob/main/README-ko_kr.md)

**향후**

공용 순수 유틸(문자열/숫자/포매터 등)을 이 경로로 추가 가능

### **5. 공개 엔트리 & 임포트 규칙**

**src/index.ts가 네임스페이스 형태로 공개**

```jsx
export * as hooks from './hooks'
export * as http from './http'
export * as utils from './utils'
export * as store from './store'
```

**네임스페이스 or 서브패스만 사용 권장 (내부 폴더 구조 변경 가능성 → 공개 표면 안정성 확보 위함)**

```jsx
import { http, store } from '@ci-repo/corelib' // 네임스페이스
import type { HttpResponse } from '@ci-repo/corelib/http' // 서브패스
import { createEncryptedStore } from '@ci-repo/corelib/store' // 서브패스
```

### **6. 빌드/설정 포인트**

- **ESM 기준:** 소비자(Next 15/Vite)가 친화적
- **Turborepo outputs:** 번들 배포 시 dist/**를 turbo.json outputs에 포함해야 캐시 적중
- **ESLint:** 루트 eslint.config.js는 외부 프리셋(@dexp/eslint-config) 사용
- **환경변수:** NEXT_PUBLIC_ZUSTAND_SECRET(암호화 PSK) — dev 더미키는 운영 금지